---
# Tavern Configuration - Global settings for API tests
variables:
  # API Configuration
  api_base_url: "{env:TEST_API_BASE_URL:http://localhost:8080}"
  
  # OAuth Configuration
  oauth_service_id: "{env:OAUTH_SERVICE_ID:qa_comprehensive_test_service}"
  oauth_private_key: "{env:TEST_OAUTH_PRIVATE_KEY}"
  oauth_audience: "{env:OAUTH_AUDIENCE:luceron-auth-server}"
  
  # Test Data Configuration
  test_data_prefix: "TAVERN_TEST"
  
  # Performance Thresholds (seconds)
  create_threshold: "{env:CREATE_THRESHOLD:3.0}"
  read_threshold: "{env:READ_THRESHOLD:2.0}"
  update_threshold: "{env:UPDATE_THRESHOLD:2.0}"
  delete_threshold: "{env:DELETE_THRESHOLD:2.0}"

# Global request configuration
request_defaults:
  headers:
    content-type: application/json
    accept: application/json

# Custom functions for OAuth token generation and validation
stages:
  - id: get_oauth_token
    name: Get OAuth Token
    request:
      url: "{api_base_url}/oauth/token"
      method: POST
      headers:
        content-type: application/x-www-form-urlencoded
      data:
        grant_type: client_credentials
        client_id: "{oauth_service_id}"
        client_assertion_type: urn:ietf:params:oauth:client-assertion-type:jwt-bearer
        client_assertion: !function "tavern_helpers:generate_jwt_token"
    response:
      status_code: 200
      json:
        access_token: !anystr
      save:
        json:
          oauth_token: access_token

# Common validation functions
strict: true